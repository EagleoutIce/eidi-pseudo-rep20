%% -----------------------------------------------------------------------------
%% Basic Packages
%% -----------------------------------------------------------------------------

% center stuff and maybe add bibliography? :D

% encoding:
\RequirePackage[T1]{fontenc}
\RequirePackage[utf8]{inputenc}

\RequirePackage[defaultfam,light,tabular,lining]{montserrat}
\RequirePackage{sfmath,tikz} % we need it anyways - will load xcolor

\usetikzlibrary{calc, arrows.meta, decorations, decorations.pathreplacing}

\RequirePackage[english,main=ngerman]{babel}

\RequirePackage{microtype,csquotes}
\RequirePackage{sopra-listings,sopra-models,sopra-attachments,forest,array,booktabs,colortbl}
\solLoadLanguage{bash}

%% -----------------------------------------------------------------------------
%% Theme
%% -----------------------------------------------------------------------------
\usepackage[emblem,theorems]{beamerthemecolorful-dream}

\makeatletter

\lstcolorlet{keywordA}{btcd@color@primary}
\lstcolorlet{keywordB}{btcd@color@secondary}
\lstcolorlet{keywordC}{btcd@color@secondary}
\lstcolorlet{comments}{btcd@color@primary!20!btcd@color@white!50!btcd@color@black}
\lstcolorlet{numbers}{btcd@color@alerted!90!btcd@color@primary!50!btcd@color@black}

\lstcolorlet{literals}{btcd@color@alerted!60!btcd@color@primary!80!btcd@color@black}
\sol@list@define@styles{%
  {keywordA: \color{sol@colors@lst@keywordA}\bfseries},%
  {keywordB: \color{sol@colors@lst@keywordB}},%
  {keywordC: \color{sol@colors@lst@keywordC}},%
}

%% -----------------------------------------------------------------------------
%% Extra Defs
%% -----------------------------------------------------------------------------

% Taken from lilly code extensions
\newenvironment{lillyHighlight}[1][]
{\begingroup\tikzset{lilly@Highlight@par/.style={#1}}\begin{lrbox}{\@tempboxa}}
{\end{lrbox}\lilly@lsthighlight@box[lilly@Highlight@par]{\@tempboxa}\endgroup}

\newcommand*\@lillyLstHL[1][]{%
  \begin{lillyHighlight}[#1]\bgroup\aftergroup\lilly@lsthighlight@endenv%
}
\def\lilly@lsthighlight@endenv{%
  \end{lillyHighlight}%
  \egroup
}

\newcommand*{\lilly@lsthighlight@box}[2][]{%
  \tikz[#1]{%
    \pgfpathrectangle{\pgfpoint{1pt}{0pt}}{\pgfpoint{\wd #2}{\ht #2}}%
    \pgfusepath{use as bounding box}%
    \node[anchor=base west, outer sep=\z@,inner xsep=1pt, inner ysep=-1.105pt, rounded corners=1.65pt, minimum height=\ht\strutbox+1pt,#1]{\raisebox\p@{\strut}\strut\usebox{#2}};
  }%
}

\def\lstHLZWS{\@lillyLstHL[fill=btcd@color@primary!24,draw=btcd@color@primary!24]}
\def\lstHLVGL{\@lillyLstHL[fill=btcd@color@alerted!36!btcd@color@primary!36,draw=btcd@color@alerted!36!btcd@color@primary!36]}
\def\lstHLINK{\@lillyLstHL[fill=btcd@color@alerted!24,draw=btcd@color@alerted!24]}
\def\lstHLDEK{\@lillyLstHL[fill=btcd@color@black!12,draw=btcd@color@black!12]}

\lstdefinelanguage{xJava}{
    language=lJava,
    moredelim=**[is][{\lstHLZWS}]{|zws|}{|zws|},%
    moredelim=**[is][{\lstHLVGL}]{|vgl|}{|vgl|},%
    moredelim=**[is][{\lstHLINK}]{|inc|}{|inc|},%
    moredelim=**[is][{\lstHLDEK}]{|dec|}{|dec|}%
}

\def\linksort#1{\hyperlink{mrk:sort-#1}{#1}}
\def\alglabel#1{\hypertarget<1>{mrk:sort-#1}{}}

\def\<{\ensuremath{\langle}}
\def\>{\ensuremath{\rangle}}
\def\mto{\ensuremath{\to}}
\def\mprec{\ensuremath{\prec}}

%% -----------------------------------------------------------------------------
%% General
%% -----------------------------------------------------------------------------

\setcounter{tocdepth}{4}

\newcounter{ctrtasks}
\def\Task#1{\only<1>{\stepcounter{ctrtasks}\pdfbookmark[4]{Aufgabe \thectrtasks: #1}{id@bkmrk@eidi@\thectrtasks}}}
\def\Time#1{\ifx!#1!\else\hbox{}\hfill(#1\;\ifnum#1=1\relax Minute\else Minuten\fi)\fi}

\colorlet{solidF}{btcd@color@primary!25!btcd@color@black}

\colorlet{fillA}{btcd@color@primary!15!white}
\colorlet{fillB}{btcd@color@secondary!15!white}
\colorlet{fillC}{btcd@color@alerted!15!white}

\long\def\hl#1{\textcolor{btcd@color@secondary}{#1}}
\long\def\imp#1{\textcolor{btcd@color@alerted}{#1}}
\let\say\enquote

\def\widei{\itemsep=1em}

\newcommand\twosplit[3][t]{%
\begin{columns}[#1]
\begin{column}{0.475\linewidth}
    #2
\end{column}\hfill
\begin{column}{0.475\linewidth}
    #3
\end{column}
\end{columns}
}

\def\O{\ensuremath{\mathcal{O}}}

\AtBeginDocument{%
    \tikzumlset{fill class=btcd@color@white,font=\small\ttfamily,fill object=btcd@color@white}%
    \attachfilesetup{color=btcd@color@secondary,author={Florian Sihler}}%
}

%% -----------------------------------------------------------------------------
%% TikZ
%% -----------------------------------------------------------------------------

\tikzset{
    block/.style={rectangle,draw,#1,font=\color{btcd@color@black},rounded corners=\z@,minimum height=\baselineskip,execute at begin node={\strut},rounded corners=\p@},
    block/.default=solidF,
    iblock/.style={block=btcd@color@primary,fill=btcd@color@primary!21!btcd@color@white},
    ball/.style={circle,draw,#1,font=\color{btcd@color@black}},
    iball/.style={ball=btcd@color@primary,fill=btcd@color@primary!21!btcd@color@white},
    oball/.style={ball=btcd@color@alerted,fill=btcd@color@alerted!21!btcd@color@white},
    ball/.default=solidF, link/.style={-Kite},
    enode/.style={inner sep=\z@},%
    every picture/.append style={line join=round,line cap=round}%
}

%% -----------------------------------------------------------------------------
%% Heap and Stack
%% -----------------------------------------------------------------------------

\usepackage{lecture-heap-n-stack}

\let\lhnselementformat\texttt
\def\lhnsielementformat#1{\textbf{\vphantom{A}#1}}
\let\lhnselementbox\pbox%
\lhns@minborderheight=4.75cm
\lhns@borderbuff=1.33em
\tikzset{lhns@impstyle/.style={}}%


%% -----------------------------------------------------------------------------
%% Different Versions
%% -----------------------------------------------------------------------------
\usepackage{lithie-profiles}

\RegisterProfile{short}{}

\newif\ifull
\ifprofile{default}{%
  \def\profileshorttitle{Volle Version}
  \ulltrue
}{
\ifprofile{short}{%
  \def\profileshorttitle{Kurze Version}
  \ullfalse
}{}%
}
% => empty Ã¼bungsaufgaben (gray + no link)
\ifull
\let\fullsubsection\subsection
\else
\let\fullsubsection\fakesubsection
\fi
\makeatother